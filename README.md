# Face-Recognition-Pytorch
Training Siamese model to create an one shot neural network model using Face-Net and MTCNN as backbone. Yolov5 and OpenCV is used alongside to classify faces in the webcam feed.
We are trying to implement face-recognition with very less memory usuage by switching between yolov5 and MTCNN when necessary .Target of this repository is to use run facial recognition in the background to ensure user privacy and protection while leaving more than enough memory for the user to continue using the device for personal uses.

## Algorthim for Training Siamese Model:
We are using Olivetti dataset which contains images of faces of 40 different people with 10 images for each person. We use these dataset and resize each faces to 128×128 image which is then normalized and fed into pre-trained InceptionResnetV1 (vggface2 dataset weights) which returns embeddings of shape 1×512. These embeddings represents the encoded features for an image. We then take embeddings of any two images and feed it into Siamese model where the model returns a value between 0 and 1 which represents how similar are the images that was fed. We are only training the siamese model as the InceptionResnetV1 is already trained.

## Using Yolov5 :
MTCNN takes up most of the memory if it directly feeds the webcam feed. To solve this problem we are using Yolov5 model to detect if there are any people in the webcam feed and if there is any change in number of people in the webcam feed. If there is a change we are then using MTCNN network to detect faces to create boxes for the faces which is used to crop and resize the faces to size of 128×128 which is then normalized and fed into InceptionResnetV1 giving us target embeddings. Similairly these image embeddings are previously saved for reference images that are present in each classes in the database while initializing the models so that it can be loaded directly in the fututre. Thes target and reference embeddings are fed into Siamese model which finds the similarity between target and each reference images. The reference image with highest similarity that crosses the minimum threshold is the predicted class. While using yolov5 model there might be some slight error in accuracy giving us extra boxes with low person probability which might trigger MTCNN frequently causing drop in fps and increased memory usuage. To solve this problem we are using cooldown timer to check if the change is real or if its due to error caused by low accuracy of Yolov5 model. We are also using IOU to match the boxes generated by Yolov5 and MTCNN so that the classified classes are matched with its respective bounding boxes.

## Drawbacks :
This program is only meant to detect and classify people in the webcam feed so that it can be used to ensure user privacy by trading less memory over accuracy. This makes the program weak in marking the objects. For example say there are 3 people present in the webcam , if these people start moving while actively being present inside the frame of the webcam then the program might get confused while marking which class name belongs to which person. But the position actually doesn't matter to ensure users privacy. Still this problem can be solved by implementing short term memory for previous object location and using it to predict the closest possible location. Here I have solved problem slightly inefficient by running MTCNN network every few seconds.

## Quick start :
### 1. Install Requirements :
```shell
pip install -r requirements.txt
```

### 2. Usage :
#### Default setup :
```
Database path : database/
Siamese model path : saved_models/siamese_model
Yolov5 type : Medium (yolov5m)
Cooldown limit : 0.5s
Regular check limit : 3s
Screen size : 800×600
Screen Scale (x,y): (1,1)
```
#### Custom setup :
```console
usage: start.py [-h] [-db DB_PATH] [-smp SIAMESE_MODEL_PATH] [-load LOAD_FROM_FILE] [-yolov5 YOLOV5_TYPE]
                [-cdl COOLDOWN_LIMIT] [-rcl REGULAR_CHECK_LIMIT] [-size SCREEN_SIZE] [-scale SCALE]

optional arguments:
  -h, --help            show this help message and exit
  -db DB_PATH, --db_path DB_PATH
                        Database path . Use relative path . Default path : database/
  -smp SIAMESE_MODEL_PATH, --siamese_model_path SIAMESE_MODEL_PATH
                        Siamese Model path . Use relative path . Default path : saved_models/siamese_model
  -load LOAD_FROM_FILE, --load_from_file LOAD_FROM_FILE
                        [TRUE] if you want to load reference embeddings from previously generated file , [FALSE] if
                        you want to recompile or create new embeddings for the reference images . Default is set to
                        TRUE
  -yolov5 YOLOV5_TYPE, --yolov5_type YOLOV5_TYPE
                        Enter which yolov5 model you want to use : [yolov5s] ,[yolov5m] ,[yolov5l] ,[yolov5x] .
                        Default type : yolov5m
  -cdl COOLDOWN_LIMIT, --cooldown_limit COOLDOWN_LIMIT
                        Lower the cooldown higher the precision higher the memory usage . Default value : 0.5s
  -rcl REGULAR_CHECK_LIMIT, --regular_check_limit REGULAR_CHECK_LIMIT
                        Helps in correcting previous errors by either the camera or the program . Default value : 3s
  -size SCREEN_SIZE, --screen_size SCREEN_SIZE
                        Set Default screen size for the webcam feed : [SCREEN_W*SCREEN_H] . Default size : 800*600
  -scale SCALE, --scale SCALE
                        Set Default scale for the webcam feed : [SCALE_X*SCALE_Y] . Default size : 1*1

```
#### Example :

```shell
python start.py -db ../../Documents/database/ -smp ../../Documents/saved_models/siamese_model -load TRUE -yolov5 yolov5m -cdl 0.25 -rcl 3 -size 775*580 -scale 1*1
```
#### Screenshots : 
![image](https://user-images.githubusercontent.com/57902078/139665172-f2befe7d-b4cc-4f10-8206-f76b899be46f.png)

![image](https://user-images.githubusercontent.com/57902078/139664693-0ebe95d7-b8bf-4460-b6a3-fc525c33e233.png)

### 3. Result :
I changed the webcam feed to sample Image. While testing with my webcam directly I was still able to maintain high fps while consuming very less memory

![result](https://user-images.githubusercontent.com/57902078/139665886-504cea98-3b9d-4f16-88a7-5c30c50083bf.png)

